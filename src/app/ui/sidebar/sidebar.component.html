<p-drawer #drawerRef [visible]="layoutStore.sidebarOpened()" (onHide)="layoutStore.closeSidebar()">
  <ng-template #headless>
    <div class="flex flex-col h-full bg-white">

      <!-- Header -->
      <header class="flex items-center justify-between px-6 py-4 shrink-0 border-b border-surface-200">
        <div class="flex items-center">
          <img class="h-12 w-auto" src="/assets/images/logo-company.png" alt="Logo" />
        </div>
        <p-button
          type="button"
          (click)="layoutStore.closeSidebar()"
          icon="pi pi-times"
          [rounded]="true"
          [text]="true"
          severity="secondary"
          styleClass="h-10 w-10">
        </p-button>
      </header>

      <!-- Navigation -->
      <nav class="flex-1 overflow-y-auto px-3 py-4">
        <ul class="space-y-1">

          <!-- Menu Items -->
          @for (item of getVisibleMenuItems(); track item.label) {
            <li>

              <!-- Item sin hijos (link directo) -->
              @if (!item.children) {
                <a pRipple
                   [routerLink]="item.route"
                   routerLinkActive="bg-sky-50 text-sky-700 font-semibold"
                   [routerLinkActiveOptions]="{exact: false}"
                   (click)="navigateAndClose(item.route)"
                   class="flex items-center gap-3 px-4 py-3 rounded-lg text-surface-700 hover:bg-sky-50 transition-all duration-200 cursor-pointer group">
                  <i [class]="'pi ' + item.icon + ' text-lg'"></i>
                  <span class="flex-1">{{ item.label }}</span>
                  @if (item.badge) {
                    <span class="flex items-center justify-center min-w-[1.5rem] h-6 px-2 bg-sky-500 text-white text-xs font-semibold rounded-full">
                      {{ item.badge }}
                    </span>
                  }
                </a>
              }

              <!-- Item con hijos (secciÃ³n expandible) -->
              @if (item.children) {
                <div>
                  <button
                    pRipple
                    (click)="toggleSection(item)"
                    class="w-full flex items-center gap-3 px-4 py-3 rounded-lg text-surface-700 hover:bg-sky-50 transition-all duration-200 cursor-pointer group">
                    <i [class]="'pi ' + item.icon + ' text-lg'"></i>
                    <span class="flex-1 text-left font-medium">{{ item.label }}</span>
                    <i class="pi pi-chevron-down text-sm transition-transform duration-200"
                       [class.rotate-180]="item.expanded"></i>
                  </button>

                  <!-- Submenu -->
                  @if (item.expanded) {
                    <ul class="mt-1 ml-4 space-y-1 border-l-2 border-sky-200 pl-4">
                      @for (child of item.children; track child.label) {
                        <li>
                          <a pRipple
                             [routerLink]="child.route"
                             routerLinkActive="bg-sky-50 text-sky-700 font-semibold"
                             [routerLinkActiveOptions]="{exact: false}"
                             (click)="navigateAndClose(child.route)"
                             class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-surface-600 hover:bg-sky-50 transition-all duration-200 cursor-pointer text-sm">
                            <i [class]="'pi ' + child.icon + ' text-base'"></i>
                            <span class="flex-1">{{ child.label }}</span>
                            @if (child.badge) {
                              <span class="flex items-center justify-center min-w-[1.25rem] h-5 px-1.5 bg-sky-500 text-white text-xs font-semibold rounded-full">
                                {{ child.badge }}
                              </span>
                            }
                          </a>
                        </li>
                      }
                    </ul>
                  }
                </div>
              }

            </li>
          }

        </ul>
      </nav>

      <!-- Footer -->
      <footer class="shrink-0 border-t border-surface-200">
        <div class="flex items-center justify-around p-4">
          <button
            pRipple
            class="flex items-center gap-2 px-4 py-2.5 rounded-lg text-surface-700 hover:bg-sky-50 transition-all duration-200 cursor-pointer">
            <i class="pi pi-question-circle text-lg"></i>
            <span class="font-medium text-sm">Ayuda</span>
          </button>
          <button
            pRipple
            class="flex items-center gap-2 px-4 py-2.5 rounded-lg text-surface-700 hover:bg-sky-50 transition-all duration-200 cursor-pointer">
            <i class="pi pi-cog text-lg"></i>
            <span class="font-medium text-sm">Config</span>
          </button>
        </div>
      </footer>

    </div>
  </ng-template>
</p-drawer>
