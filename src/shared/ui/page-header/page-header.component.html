<div class="mb-6 space-y-4">
  <!-- First row: Back button + Actions -->
  <div class="flex items-center justify-between gap-4">
    <!-- Back Button -->
    @if (showBackButton()) {
      @if (backRoute()) {
        <a
        pRipple
          [routerLink]="backRoute()"
          [class.pointer-events-none]="loading()"
          [class.opacity-50]="loading()"
          class="flex shrink-0 items-center gap-2 text-sm font-medium text-gray-600 transition-colors hover:text-gray-900">
        <i [class]="'text-sm pi ' + backIcon()"></i>
        <span class="hidden sm:inline">{{ backLabel() }}</span>
        </a>
      } @else {
        <button
          pRipple
          type="button"
          (click)="onBackClick()"
          [disabled]="loading()"
          class="flex shrink-0 items-center gap-2 text-sm font-medium text-gray-600 transition-colors hover:text-gray-900 disabled:cursor-not-allowed disabled:opacity-50">
          <i [class]="'text-sm pi ' + backIcon()"></i>
          <span class="hidden sm:inline">{{ backLabel() }}</span>
        </button>
      }
    }

    <!-- Actions Container -->
    @if (!loading()) {
      <!-- Desktop Actions -->
      <div class="hidden items-center gap-2 lg:flex">
        @if (showRefreshButton()) {
          <button
            pRipple
            type="button"
            (click)="onRefreshClick()"
            [disabled]="loading()"
            class="flex h-9 w-9 shrink-0 items-center justify-center rounded-lg border border-gray-300 bg-white text-gray-700 transition-all hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-50"
            [attr.aria-label]="'Refrescar'">
            @if (loading()) {
              <i class="pi pi-spinner pi-spin text-base"></i>
            } @else {
              <i class="pi pi-refresh text-base"></i>
            }
          </button>
        }

        @for (action of visiblePrimaryActions(); track action.id) {
          <button
            pRipple
            type="button"
            (click)="action.onClick()"
            [disabled]="action.disabled || loading()"
            [class]="getActionClasses(action.variant)">
            <i [class]="'text-sm pi ' + action.icon"></i>
            <span>{{ action.label }}</span>
          </button>
        }

        @if (showDesktopMoreActionsButton) {
          <button
            #desktopMoreActionsBtn
            pRipple
            type="button"
            (click)="toggleMoreActions($event, desktopMoreActionsMenu)"
            [disabled]="loading()"
            class="flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 transition-all hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-50">
            <span>{{ moreActionsLabel() }}</span>
            <i class="pi pi-chevron-down text-xs"></i>
          </button>

          <p-menu
            #desktopMoreActionsMenu
            [model]="visibleMoreActions"
            [popup]="true"
            appendTo="body">
          </p-menu>
        }
      </div>

      <!-- Mobile Actions -->
      <div class="flex items-center gap-2 lg:hidden">
        <!-- Refresh siempre visible en mobile -->
        @if (showRefreshButton()) {
          <button
            pRipple
            type="button"
            (click)="onRefreshClick()"
            [disabled]="loading()"
            class="flex h-9 w-9 shrink-0 items-center justify-center rounded-lg border border-gray-300 bg-white text-gray-700 transition-all hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-50"
            [attr.aria-label]="'Refrescar'">
            @if (loading()) {
              <i class="pi pi-spinner pi-spin text-base"></i>
            } @else {
              <i class="pi pi-refresh text-base"></i>
            }
          </button>
        }

        <!-- Acciones primarias en mobile (solo si strategy es 'compact') -->
        @for (action of mobilePrimaryActions(); track action.id) {
          <button
            pRipple
            type="button"
            (click)="action.onClick()"
            [disabled]="action.disabled || loading()"
            class="flex h-9 w-9 shrink-0 items-center justify-center rounded-lg border border-gray-300 bg-white text-gray-700 transition-all hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-50"
            [attr.aria-label]="action.label">
            <i [class]="'text-base pi ' + action.icon"></i>
          </button>
        }

        <!-- MenÃº de acciones en mobile -->
        @if (showMobileMoreActionsButton) {
          <button
            #mobileMoreActionsBtn
            pRipple
            type="button"
            (click)="toggleMoreActions($event, mobileMoreActionsMenu)"
            [disabled]="loading()"
            class="flex h-9 w-9 shrink-0 items-center justify-center rounded-lg border border-gray-300 bg-white text-gray-700 transition-all hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-50"
            [attr.aria-label]="moreActionsMobileLabel()">
            <i class="pi pi-ellipsis-v text-base"></i>
          </button>

          <p-menu
            #mobileMoreActionsMenu
            [model]="mobileMenuActions()"
            [popup]="true"
            appendTo="body">
          </p-menu>
        }
      </div>
    }
  </div>

  <!-- Segunda fila: Title Section -->
  <div class="flex items-start gap-3">
    <!-- Title Icon (opcional) -->
    @if (titleIcon()) {
      <div class="mt-1 flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-gradient-to-br from-sky-500 to-cyan-500 text-white shadow-sm">
        <i [class]="'text-lg pi ' + titleIcon()"></i>
      </div>
    }

    <!-- Title & Content -->
    <div class="min-w-0 flex-1">
      <!-- Loading State -->
      @if (loading()) {
        <div class="space-y-2">
          <div class="h-8 w-full max-w-md animate-pulse rounded bg-gray-200"></div>
          <div class="h-4 w-full max-w-lg animate-pulse rounded bg-gray-200"></div>
        </div>
      } @else {
        <!-- Title & Subtitle -->
        <div class="space-y-1">
          <h1
            [class]="titleClasses()"
            [title]="truncateTitle() ? title() : ''">
            {{ title() }}
          </h1>
          @if (subtitle()) {
            <p
              [class]="subtitleClasses()"
              [title]="truncateSubtitle() ? subtitle() : ''">
              {{ subtitle() }}
            </p>
          }
        </div>

        <!-- Custom Header Content -->
        @if (headerContent()) {
          <div class="mt-3 min-w-0">
            <ng-container [ngTemplateOutlet]="headerContent()!" />
          </div>
        }
      }
    </div>
  </div>
</div>
